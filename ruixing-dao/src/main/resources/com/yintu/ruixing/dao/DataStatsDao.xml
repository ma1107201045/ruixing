<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yintu.ruixing.dao.DataStatsDao">

    <resultMap type="com.yintu.ruixing.entity.DataStatsEntity" id="dataStatEntities">
        <result property="tljName" column="tlj_name"/>
        <result property="dwdName" column="dwd_name"/>
        <result property="dwdMiaoShu" column="dwd_miaoshu"/>
        <result property="tljMiaoShu" column="tlj_miaoshu"/>
        <result property="xdName" column="xd_name"/>
        <result property="xdMiaoShu" column="xd_miaoshu"/>
        <result property="cid" column="cid"/>
        <result property="tid" column="tid"/>
        <result property="did" column="did"/>
        <result property="xid" column="xid"/>
        <result property="czName" column="cz_name"/>
        <result property="czId" column="cz_id"/>
        <result property="tljId" column="tlj_id"/>
        <result property="dwdId" column="dwd_id"/>
        <result property="xdId" column="xd_id"/>
        <result property="czNameJianCheng" column="cz_name_jiancheng"/>
        <result property="czIp" column="cz_ip"/>
        <result property="czType" column="cz_type"/>
        <result property="czStutrs" column="cz_stutrs"/>
        <result property="czOpenStutrs" column="cz_open_stutrs"/>
        <result property="czLastTime" column="cz_lasttime"/>
        <result property="xdCzId" column="xd_cz_id"/>
        <result property="czMiaoShu" column="cz_miaoshu"/>
        <result property="czDuanTou" column="cz_duantou"/>
        <result property="xdState" column="xd_state"/>
        <result property="xdJson" column="xd_json"/>
        <result property="czState" column="cz_state"/>
        <result property="czJson" column="cz_json"/>
    </resultMap>

    <!--查詢所有的车站数据-->
    <select id="findAll" resultType="com.yintu.ruixing.entity.DataStatsEntity" resultMap="dataStatEntities">
     SELECT
		tlj.tlj_name,
		dwd.dwd_name,
		xd.xd_name,
		cz.cz_name,
		cz.cid,
		cz.cz_ip,
		cz.cz_type,
		cz.cz_lasttime,
		cz.cz_open_stutrs
	FROM
		mro_chezhan cz,
		mro_dianwuduan dwd,
		mro_tieluju tlj,
		mro_xianduan xd
	WHERE
		tlj.id = dwd.tlj_dwd_id
		AND dwd.id = xd.dwd_xd_id
		AND xd.id = cz.xd_cz_id

    </select>

    <!--根据id批量删除车站-->
    <delete id="delCheZhanListById" parameterType="java.util.List">
        delete from mro_chezhan
        where cid
        in
        <foreach collection="array" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!--查询所有车站信息-->
    <select id="findAllCheZhan" resultMap="dataStatEntities">
            SELECT
                tlj.tlj_name,
                dwd.dwd_name,
                xd.xd_name,
                cz.cz_name,
                cz.cz_miaoshu,
                xd.xd_state,
                xd.xd_json,
                cz.cz_state,
                cz.cz_json,
                cz.cz_id,
                cz.xd_id,
                cz.cid,
                cz.xd_cz_id
            FROM
                mro_tieluju tlj,
                mro_dianwuduan dwd,
                mro_xianduan xd,
                mro_chezhan cz
            WHERE
                tlj.tid = dwd.tlj_dwd_id
                AND dwd.did = xd.dwd_xd_id
                AND xd.xid = cz.xd_cz_id
            ORDER BY
                tlj.tlj_name
    </select>
    <resultMap type="com.yintu.ruixing.entity.TieLuJuEntity" id="tieluju">
        <result property="tid" column="tid"/>
        <result property="tljId" column="tlj_id"/>
        <result property="tljName" column="tlj_name"/>
        <result property="tljMiaoShu" column="tlj_miaoshu"/>
        <result property="dwdName" column="dwd_name"/>
    </resultMap>

    <!--根据铁路局id 查询铁路局下的所有车站-->
    <select id="findTieLuJuById" resultType="com.yintu.ruixing.entity.DataStatsEntity" parameterType="java.lang.Long"
            resultMap="dataStatEntities">
        <!--SELECT
        tlj.tlj_name,
        tlj.tlj_miaoshu,
        dwd.dwd_name
        FROM
        mro_tieluju tlj
        left join mro_dianwuduan dwd
        on tlj.tid = dwd.tlj_dwd_id
        <where>
            <if test=" tid  !=null">
                tlj.tid = #{tid}
            </if>
        </where>-->

        SELECT
        tlj.tlj_name,
        tlj.tlj_id,
        tlj.tlj_miaoshu,
        dwd.dwd_name,
        xd.xd_name,
        cz.cz_name,
        cz.cz_miaoshu,
        xd.xd_state,
        xd.xd_json,
        cz.cz_state,
        cz.cz_json
        FROM
        mro_tieluju tlj,
        mro_dianwuduan dwd,
        mro_xianduan xd,
        mro_chezhan cz
        WHERE
        tlj.tid = dwd.tlj_dwd_id
        AND dwd.did = xd.dwd_xd_id
        AND xd.xid = cz.xd_cz_id
        AND tlj.tid = #{tid}

    </select>
    <!--根据电务段id  查询此电务段下的所有车站信息-->
    <select id="findDianWuDuanCheZhanById" resultType="com.yintu.ruixing.entity.DataStatsEntity" parameterType="java.lang.Long"
            resultMap="dataStatEntities">
        SELECT
            tlj.tlj_name,
            dwd.dwd_name,
            dwd.dwd_id,
            dwd.dwd_miaoshu,
            xd.xd_name,
            cz.cz_name,
            cz.cz_miaoshu,
            xd.xd_state,
            xd.xd_json,
            cz.cz_state,
            cz.cz_json
        FROM
            mro_tieluju tlj,
            mro_dianwuduan dwd,
            mro_xianduan xd,
            mro_chezhan cz
        WHERE
            tlj.tid = dwd.tlj_dwd_id
            AND dwd.did = xd.dwd_xd_id
            AND xd.xid = cz.xd_cz_id
            AND dwd.did =#{did}

    </select>
    <!--根据线段id   查询此线段下的所有车站信息-->
    <select id="findXianDuanCheZhanById" resultType="com.yintu.ruixing.entity.DataStatsEntity" parameterType="java.lang.Long"
            resultMap="dataStatEntities">
        SELECT
            tlj.tlj_name,
            dwd.dwd_name,
            xd.xd_name,
            xd.xd_id,
            xd.xd_miaoshu,
            xd.xd_state,
            xd.xd_json,
            cz.cz_name,
            cz.cz_state,
            cz.cz_json,
            cz.cz_miaoshu
        FROM
            mro_tieluju tlj,
            mro_dianwuduan dwd,
            mro_xianduan xd,
            mro_chezhan cz
        WHERE
            tlj.tid = dwd.tlj_dwd_id
            AND dwd.did = xd.dwd_xd_id
            AND xd.xid = cz.xd_cz_id
            AND xd.xid =#{xid}
    </select>

    <!--根据车站id   查询此车站的id-->
    <select id="findCheZhanById" resultType="com.yintu.ruixing.entity.DataStatsEntity" parameterType="java.lang.Long"
            resultMap="dataStatEntities">
        SELECT
            tlj.tlj_name,
            dwd.dwd_name,
            xd.xd_name,
            xd.xd_state,
            xd.xd_json,
            cz.cz_state,
            cz.cz_json,
            cz.cz_name,
            cz.cz_id,
            cz.cz_miaoshu
        FROM
            mro_tieluju tlj,
            mro_dianwuduan dwd,
            mro_xianduan xd,
            mro_chezhan cz
        WHERE
            tlj.tid = dwd.tlj_dwd_id
            AND dwd.did = xd.dwd_xd_id
            AND xd.xid = cz.xd_cz_id
            AND cz.cid =#{cid}

    </select>


    <!--根据线段id  更改线段的状态-->
    <update id="editStateByXid" parameterType="com.yintu.ruixing.entity.XianDuanEntity" >
        update mro_xianduan
        <set>
            <if test="xdState !=null">
                xd_state = #{xdState},
            </if>
            <if test="xdState !=null">
                xd_json = #{xdJson}
            </if>
        </set>
        where xid = #{xid}
    </update>

    <!--根据车站id  更改车站的状态-->
    <update id="editStateByCid" parameterType="com.yintu.ruixing.entity.CheZhanEntity" >
        update mro_chezhan
        <set>
            <if test="czState !=null">
                cz_state = #{czState},
            </if>
            <if test="czState !=null">
                cz_json = #{czJson}
            </if>
        </set>
        where cid = #{cid}
    </update>



    <!--查询所有的铁路局-->
    <select id="findAllTieLuJu"  resultMap="tieluju">
        SELECT
            tlj.tid,
            tlj.tlj_name
        FROM
            mro_tieluju tlj
    </select>

    <resultMap type="com.yintu.ruixing.entity.DianWuDuanEntity" id="dianwuduan">
        <result property="did" column="did"/>
        <result property="dwdId" column="dwd_id"/>
        <result property="tljId" column="tlj_id"/>
        <result property="dwdName" column="dwd_name"/>
        <result property="tljDwdId" column="tlj_dwd_id"/>
        <result property="dwdMiaoShu" column="dwd_miaoshu"/>
    </resultMap>
    <!--根据tid查询对应的电务段-->
    <select id="findDianWuDuanByTid" parameterType="java.lang.Integer" resultMap="dianwuduan">

        SELECT
            did,
            dwd_name
        FROM
            mro_dianwuduan
        WHERE
            tlj_dwd_id = #{tid}
    </select>

    <resultMap type="com.yintu.ruixing.entity.XianDuanEntity" id="xianduan">
        <result property="xid" column="xid"/>
        <result property="xdId" column="xd_id"/>
        <result property="dwdId" column="dwd_id"/>
        <result property="xdName" column="xd_name"/>
        <result property="xdZgName" column="xd_zg_name"/>
        <result property="dwdXdId" column="dwd_xd_id"/>
        <result property="xdMiaoShu" column="xd_miaoshu"/>
        <result property="xdType" column="xd_type"/>
        <result property="xdState" column="xd_state"/>
        <result property="xdJson" column="xd_json"/>
    </resultMap>
    <!--根据did查询线段的名字和id-->
    <select id="findXianDuanByDid" resultMap="xianduan" parameterType="java.lang.Integer">
        SELECT
            xid,
            xd_name
        FROM
            mro_xianduan
        WHERE
            dwd_xd_id = #{did}
    </select>


    <resultMap type="com.yintu.ruixing.entity.CheZhanEntity" id="chezhan">
        <result property="cid" column="cid"/>
        <result property="czName" column="cz_name"/>
        <result property="czId" column="cz_id"/>
        <result property="xdId" column="xd_id"/>
        <result property="czNameJianCheng" column="cz_name_jiancheng"/>
        <result property="czIp" column="cz_ip"/>
        <result property="czType" column="cz_type"/>
        <result property="czStutrs" column="cz_stutrs"/>
        <result property="czOpenStutrs" column="cz_open_stutrs"/>
        <result property="czCaoZuo" column="cz_caozuo"/>
        <result property="czLastTime" column="cz_lasttime"/>
        <result property="xdCzId" column="xd_cz_id"/>
        <result property="czMiaoShu" column="cz_miaoshu"/>
        <result property="czDuanTou" column="cz_duantou"/>
        <result property="czPeiZhiState" column="cz_peizhi_state"/>
        <result property="czJson" column="cz_json"/>
    </resultMap>
    <!--根据xid查询车站的名字和id-->
    <select id="findCheZhanByXid" parameterType="java.lang.Integer" resultMap="chezhan">
         SELECT
            cid,
            cz_name
        FROM
            mro_chezhan
        WHERE
            xd_cz_id = #{xid}
    </select>


    <resultMap id="quduan" type="com.yintu.ruixing.entity.QuDuanBaseEntity">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="parent_id" jdbcType="INTEGER" property="parentId"/>
        <result column="cid" jdbcType="INTEGER" property="cid"/>
        <result column="xid" jdbcType="INTEGER" property="xid"/>
        <result column="sid" jdbcType="INTEGER" property="sid"/>
        <result column="typeid" jdbcType="INTEGER" property="typeid"/>
        <result column="line" jdbcType="VARCHAR" property="line"/>
        <result column="left_right" jdbcType="VARCHAR" property="letRight"/>
        <result column="xingbie" jdbcType="INTEGER" property="xingBie"/>
        <result column="type" jdbcType="INTEGER" property="type"/>
        <result column="zongHe_id" jdbcType="VARCHAR" property="zongheId"/>
        <result column="quDuanSheJi_name" jdbcType="VARCHAR" property="quduanshejiName"/>
        <result column="quDuanYunYing_name" jdbcType="VARCHAR" property="quduanyunyingName"/>
        <result column="quDuan_length" jdbcType="INTEGER" property="quduanLength"/>
        <result column="carrier" jdbcType="VARCHAR" property="carrier"/>
        <result column="diDuan_type" jdbcType="VARCHAR" property="diduanType"/>
        <result column="xianLuQingKuang" jdbcType="VARCHAR" property="xianluqingkuang"/>
        <result column="bianJie" jdbcType="INTEGER" property="bianjie"/>
        <result column="fenJieDian_where" jdbcType="VARCHAR" property="fenjiedianWhere"/>
        <result column="zhanQuFenJie" jdbcType="INTEGER" property="zhanqufenjie"/>
        <result column="jinZhanXinHaoJi_name" jdbcType="VARCHAR" property="jinzhanxinhaojiName"/>
        <result column="xinHaoJiOrBiaoZhiMing" jdbcType="VARCHAR" property="xinhaojiorbiaozhiming"/>
        <result column="xinHaoBiaoZhiPai_where" jdbcType="VARCHAR" property="xinhaobiaozhipaiWhere"/>
        <result column="xinHaoJi_where" jdbcType="VARCHAR" property="xinhaojiWhere"/>
        <result column="zuoCeJueYuan_type" jdbcType="VARCHAR" property="zuocejueyuanType"/>
        <result column="youCeJueYuan_type" jdbcType="VARCHAR" property="youcejueyuanType"/>
        <result column="zhengXianHouFangQuDuan_ID" jdbcType="VARCHAR" property="zhengxianhoufangquduanId"/>
        <result column="zhengXianQianFangQuDuan_ID" jdbcType="VARCHAR" property="zhengxianqianfangquduanId"/>
        <result column="daoChaGuanLianQuDuan1_ID" jdbcType="VARCHAR" property="daochaguanlianquduan1Id"/>
        <result column="daoChaGuanLianQuDuan2_ID" jdbcType="VARCHAR" property="daochaguanlianquduan2Id"/>
        <result column="dianMaHuaGuiHao" jdbcType="VARCHAR" property="dianmahuaguihao"/>
        <result column="guiNeiDiZhi" jdbcType="INTEGER" property="guineidizhi"/>
        <result column="time" jdbcType="TIMESTAMP" property="time"/>
        <result column="yuliu" jdbcType="VARCHAR" property="yuliu"/>
        <association property="xianDuanEntity"  javaType="XianDuanEntity" resultMap="xianduan">
            <result column="xid" property="xid"></result>
            <result column="xd_name" property="xdName"></result>
        </association>
        <association property="cheZhanEntity" javaType="CheZhanEntity" resultMap="chezhan">
            <result column="cid" property="cid"></result>
            <result column="cz_name" property="czName"></result>
        </association>
    </resultMap>
    <!--查询站外所有区段信息-->
    <select id="findAllQuDuan" resultMap="quduan">
        SELECT
            cz.cz_name,
            xd.xd_name,
            qb.*
        FROM
            mro_quduan_base qb,
            mro_xianduan xd,
            mro_chezhan cz
        WHERE
            qb.cid = cz.cid
            AND qb.xid = xd.xid
            AND line != '电码化'

    </select>






























    <!--根据铁路局tid和电务段did查询对应线段-->
    <select id="findDianWuDuanById" parameterType="java.lang.Long" resultType="com.yintu.ruixing.entity.DataStatsEntity"
            resultMap="dataStatEntities">

        SELECT
        tlj.tid,
        dwd.did,
        xd.xid,
        tlj.tlj_name,
        dwd.dwd_name,
        dwd.dwd_miaoshu,
        xd.xd_name
        FROM
        mro_tieluju tlj,
        mro_dianwuduan dwd,
        mro_xianduan xd
        WHERE
        tlj.tid = dwd.tlj_dwd_id and
        xd.dwd_xd_id=dwd.did


        <!--  SELECT
              tlj.tlj_name,
              dwd.dwd_name,
              dwd.dwd_miaoshu,
              xd.xd_name
          FROM
              mro_tieluju tlj,
              mro_dianwuduan dwd,
              mro_xianduan xd
          WHERE
              tlj.tid = dwd.tlj_dwd_id
              AND tlj.tid = #{tid}
              AND xd.dwd_xd_id = #{did}
          group by dwd.did -->
        <!-- SELECT
         tlj.tlj_name,
         dwd.dwd_name,
         dwd.dwd_miaoshu,
         xd.xd_name
         FROM
         mro_dianwuduan dwd
         LEFT JOIN mro_tieluju tlj ON tlj.tid = dwd.tlj_dwd_id
         LEFT JOIN mro_xianduan xd ON

         <if test="tid !=null">
             tlj.tid = #{tid}
         </if>
         and
         <if test="did !=null">
             xd.dwd_xd_id = #{did}
         </if>-->

    </select>
    <!--根据铁路局tid,电务段did和线段xid查询对应线段-->
    <select id="findXianDuanById" parameterType="java.lang.Long" resultType="com.yintu.ruixing.entity.DataStatsEntity"
            resultMap="dataStatEntities">
        <!--SELECT
        tlj.tlj_name,
        dwd.dwd_name,
        xd.xd_name,
        cz.cz_name,
        xd.xd_miaoshu
        FROM
        mro_tieluju tlj,
        mro_dianwuduan dwd,
        mro_xianduan xd,
        mro_chezhan cz
        WHERE
        tlj.tid = dwd.tlj_dwd_id
        AND tlj.tid = #{tid}
        AND xd.dwd_xd_id = #{did}
        AND cz.xd_cz_id = #{xid}
        -->


        SELECT
        tlj.tid,
        dwd.did,
        xd.xid,
        cz.cid,
        tlj.tlj_name,
        dwd.dwd_name,
        xd.xd_name,
        cz.cz_name,
        xd.xd_miaoshu
        FROM
        mro_tieluju tlj,
        mro_dianwuduan dwd,
        mro_xianduan xd,
        mro_chezhan cz
        WHERE
        tlj.tid = dwd.tlj_dwd_id
        AND xd.dwd_xd_id = dwd.did
        AND cz.xd_cz_id = xd.xid


    </select>
    <!--根据铁路局tid,电务段did,线段xid和车站cid查询对应车站-->
    <select id="findCheZhanById1" resultType="com.yintu.ruixing.entity.DataStatsEntity" parameterType="java.lang.Long"
            resultMap="dataStatEntities">
		SELECT
			tlj.tlj_name,
			dwd.dwd_name,
			xd.xd_name,
			cz.cz_name,
			cz.cz_miaoshu
		FROM
			mro_tieluju tlj,
			mro_dianwuduan dwd,
			mro_xianduan xd,
			mro_chezhan cz
		WHERE
			tlj.tid = #{tid}
			AND dwd.did =#{did}
			AND xd.xid =#{xid}
			AND cz.cid =#{cid}
	</select>
</mapper>